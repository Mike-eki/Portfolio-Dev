---
import ArrowRight from '../icons/ArrowRight.astro';
import GitHub from '../icons/GitHub.astro';
import LinkedIn from '../icons/LinkedIn.astro';
import Email from '../icons/Email.astro';

interface Props {
  hero: {
    eyebrow: string;
    title: string;
    subtitle: string;
    ctaContact: string;
  };
  about: {
    heading: string;
    nameLabel: string;
    roleLabel: string;
    name: string;
    role: string;
    summary: string;
    principlesTitle: string;
    principles: string[];
  };
  contactInfo: {
    emailValue: string;
    linkedinUrl: string;
    githubUrl: string;
    tooltipEmail: string;
    tooltipLinkedIn: string;
    tooltipGitHub: string;
    copied: string;
    failed: string;
  };
  encodedEmail: string;
}

const { hero, about, contactInfo, encodedEmail } = Astro.props as Props;
---

<section id="hero" class="min-h-screen flex flex-col md:flex-row md:items-center justify-center gap-8 md:gap-8 lg:gap-12 px-6 py-12 pt-24">
  <div class="space-y-3">
    <p class="text-sm uppercase tracking-[0.2em] text-sky-400">{hero.eyebrow}</p>
    <h1 class="text-4xl sm:text-5xl font-semibold">{hero.title}</h1>
    <p class="max-w-xl text-slate-300">{hero.subtitle}</p>
    <div class="mt-6 flex flex-wrap items-center gap-4">
      <a
        id="hero-cta"
        href="#contact"
        class="inline-flex items-center gap-2 rounded-md bg-sky-500 px-5 py-2 text-sm font-medium text-slate-950 hover:bg-sky-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-300"
      >
        <span>{hero.ctaContact}</span>
        <ArrowRight />
      </a>
      <div class="flex items-center gap-3 pl-3 border-l border-slate-700">
        <!-- Email with tooltip and copy functionality -->
        <div class="relative group">
          <button
            id="hero-email-btn"
            type="button"
            data-encoded={encodedEmail}
            data-copied={contactInfo.copied}
            data-failed={contactInfo.failed}
            class="inline-flex items-center justify-center w-9 h-9 rounded-md text-slate-300 hover:text-sky-400 hover:bg-slate-800 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-300"
            aria-label="Copy email address"
          >
            <Email class="h-4 w-4" />
          </button>
          <!-- Tooltip -->
          <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-800 text-xs text-slate-200 rounded opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all whitespace-nowrap pointer-events-none">
            <span id="hero-email-tooltip">{contactInfo.tooltipEmail}</span>
            <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800"></div>
          </div>
        </div>

        <!-- LinkedIn with tooltip -->
        <div class="relative group">
          <a
            href={contactInfo.linkedinUrl}
            target="_blank"
            rel="noreferrer noopener"
            class="inline-flex items-center justify-center w-9 h-9 rounded-md text-slate-300 hover:text-sky-400 hover:bg-slate-800 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-300"
            aria-label="LinkedIn"
          >
            <LinkedIn class="h-4 w-4" />
          </a>
          <!-- Tooltip -->
          <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-800 text-xs text-slate-200 rounded opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all whitespace-nowrap pointer-events-none">
            <span>{contactInfo.tooltipLinkedIn}</span>
            <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800"></div>
          </div>
        </div>

        <!-- GitHub with tooltip -->
        <div class="relative group">
          <a
            href={contactInfo.githubUrl}
            target="_blank"
            rel="noreferrer noopener"
            class="inline-flex items-center justify-center w-9 h-9 rounded-md text-slate-300 hover:text-sky-400 hover:bg-slate-800 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-300"
            aria-label="GitHub"
          >
            <GitHub class="h-4 w-4" />
          </a>
          <!-- Tooltip -->
          <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-800 text-xs text-slate-200 rounded opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all whitespace-nowrap pointer-events-none">
            <span>{contactInfo.tooltipGitHub}</span>
            <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="flex items-center justify-center">
    <div class="relative h-56 w-56 sm:h-64 sm:w-64 lg:h-72 lg:w-72 overflow-hidden rounded-full border-4 border-slate-800 bg-slate-900/60">
      <img
        src="/images/profile-hero.jpg" 
        alt="Portrait or illustration representing you as a fullstack developer"
        class="h-full w-full object-cover opacity-90"
      />
    </div>
  </div>
</section>

<script>
  function decodeEmail(encoded: string): string {
    return atob(encoded).split('').reverse().join('');
  }

  document.addEventListener('DOMContentLoaded', () => {
    const emailBtn = document.getElementById('hero-email-btn');
    const tooltip = document.getElementById('hero-email-tooltip');

    if (!emailBtn || !tooltip) return;

    const encodedEmail = emailBtn.dataset.encoded;
    if (!encodedEmail) return;

    const email = decodeEmail(encodedEmail);

    const copiedText = emailBtn.dataset.copied || 'Copied';
    const failedText = emailBtn.dataset.failed || 'Failed';
    const originalTooltip = tooltip.textContent;

    emailBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(email);
        tooltip.textContent = copiedText + '!';
        
        // Remove focus from button so tooltip hides on mouse leave
        emailBtn.blur();
        
        // Reset after 2 seconds
        setTimeout(() => {
          tooltip.textContent = originalTooltip;
        }, 2000);
      } catch (err) {
        console.error('Failed to copy email:', err);
        tooltip.textContent = failedText;
        emailBtn.blur();
        
        setTimeout(() => {
          tooltip.textContent = originalTooltip;
        }, 2000);
      }
    });
  });
</script>
